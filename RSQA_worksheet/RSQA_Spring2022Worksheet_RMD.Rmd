---
title: "Spring 2022 RSQA Worksheet"
author: "Noe Reyna"
date: "1/26/2022"
output: html_document
editor_options: 
  chunk_output_type: inline
---
#Loading data into R
```{r}
setwd("G:/My Drive/ComputationalStuff/UrbanEcosystems/Git/RSQA_worksheet")
library('tidyverse', 'readr')
library('dplyr')
mydata <- read.csv('1.21.2022.CSQA_ConstituentGroups=Organics,Pesticides/Results.csv')
# View(mydata)

# 12. show the frequency of parameter measurements done based on the PARM_NM column
exp_count <- mydata %>% 
  group_by(PARM_NM) %>% 
  summarise(count=n())

# create hist
param_count_hist <- ggplot(exp_count, aes(count)) +
  geom_histogram(binwidth=50) +
  labs(title='Distribution showing the number of a unique parameter\'s
  measurements [x] and respective frequency [y]', x='Measurements on a unique
  parameter') +
  theme_classic()
param_count_hist

# arrange exp_count to only contain >50 observations in desc order
exp_count <- exp_count[exp_count$count>50,]
exp_count <- exp_count[order(exp_count$count, decreasing=TRUE), ]
# view(exp_count)
```


#Plotting one parameter
```{r}
# pick parameter want to work w/ 
imidacloprid_data <- mydata[mydata$PARM_NM=='Imidacloprid, wf', ] # filter also could be used here

# make scatter plot RESULT_VA~PARM_NM [note: this is suppose to be wrong]
results_parm_scat <- ggplot(imidacloprid_data, aes(PARM_NM, RESULT_VA)) +
  geom_point()
results_parm_scat # use geom_jitter() since they're ontop of each other
# will be doing jitterplot instead since clustered
results_parm_jit <- ggplot(imidacloprid_data, aes(PARM_NM, RESULT_VA)) +
  geom_jitter() +
  theme_classic() +
  theme(axis.text=element_blank()) +
  labs(title='CSQA Measurement of Imidacloprid',
       x='Imidacloprid', y='Concentration Detected [ng/l]')
  
results_parm_jit
```


#Plotting multiple parameters
```{r}
# select the top five parameters from mydata
top_5_data <- mydata[mydata$PARM_NM %in% exp_count$PARM_NM[1:5], ]
top_5_jitterplot <- ggplot(top_5_data, aes(PARM_NM, RESULT_VA)) +
  geom_jitter(aes(color=PARM_NM)) +
  theme_classic() +
  theme(axis.text.x=element_blank()) +
  labs(title='CSQA Measurement of Various Chemicals',
       x='Chemical', y='Concentration Detected [ng/l]')
top_5_jitterplot

# instead, create a facet plot
top_5_facet <- ggplot(top_5_data, aes(PARM_NM, RESULT_VA)) +
  geom_jitter(aes(color=PARM_NM), alpha=0.35) +
  facet_wrap(.~PARM_NM, scales='free') +
  theme_classic() + theme(axis.text.x=element_blank(),
                          strip.text.x=element_blank(),
                          axis.title.x=element_blank()) +
  labs(col='Chemical', y='Concentration', title='CSQA Chemical Concentration in Stream Samples') +
  scale_color_hue(labels=c('AMPA [ug/l]', 'Glufosinate [ug/l]', 'Glyphosate [ug/l]', 'Imidacloprid [ng/l]', 'Myclobutanil [ng/l]'))

top_5_facet
```


#Plotting data on maps
```{r}
library(rnaturalearth)
library(rnaturalearthdata)
library(ggspatial)
library(rgeos)

# from the Sites.csv, join top_5_data to have coords needed for mapping
getwd()
setwd('1.21.2022.CSQA_ConstituentGroups=Organics,Pesticides')

sites <- read.csv('Sites.csv')
# head(sites)
# head(top_5_data)

top_5_joined <- left_join(top_5_data, sites, by='SITE_NO')
# view(top_5_joined)

# create world map
world <- ne_countries(scale='medium', returnclass='sf')
world_map <- ggplot(world) +
  geom_sf() +
  theme_classic() +
  labs(title='World Map', x='Longitude', y='Latitude')
world_map

# plot data onto world map
# change title
world_map <- ggplot(world) +
  geom_sf() +
  theme_classic() +
  labs(title='Map of CSQA Top 5 Contaminants in CSQA sampling sites',
       x='Longitude', y='Latitude')
world_map

# add scatter plot
world_map <- ggplot(world) +
  geom_sf() +
  theme_classic() +
  labs(title='Map of CSQA Top 5 Contaminants in CSQA sampling sites',
       x='Longitude', y='Latitude',
       subtitle=paste0('A total of ',(length(unique(sites$SITE_NO))), 'sites')) +
  geom_point(data=top_5_joined, aes(DEC_LONG_VA, DEC_LAT_VA), size=1, shape=19) +
  coord_sf(xlim=c(min(sites$DEC_LONG_VA), max(sites$DEC_LONG_VA)),
           ylim=c(min(sites$DEC_LAT_VA), max(sites$DEC_LAT_VA)))
world_map
```



#Replicating plots
```{r}
# get data; filter for Pyrene, solids
setwd('RSQA_Problemset_Spring2022')
fig1_data <- read_csv('Results.csv')
# View(fig1_data)
fig1_data <- fig1_data %>% 
  filter(PARM_NM=='Pyrene, solids') %>% 
  group_by(SITE_NO) %>%
  top_n(1, RESULT_VA) %>% 
  select(SITE_NO, RESULT_VA, COUNTY_NM)

# make jitter plot
ggplot(fig1_data, aes(COUNTY_NM, RESULT_VA)) +
  geom_jitter(aes(col=COUNTY_NM))

```

